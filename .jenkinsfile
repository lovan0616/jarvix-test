pipeline {
    agent any

    environment {
        ARTIFACT_NAME  = "dist.tar.gz"
    }

    stages {
        stage('Starting') {
            steps {
                sh '~/.scripts/ci/slack-starting.sh'
            }
        }
        stage('Build') {
            steps {
                sh 'npm install'
                sh 'npm run build'
                sh 'touch dist/version'
                sh "tar zcf ${ARTIFACT_NAME} dist"
            }
        }
        stage('Artifact') {
            steps {
                sh '''
                    set +x
                    curl -v -f -u ${NEXUS_USER}:${NEXUS_PASS} \
                        --upload-file ${ARTIFACT_NAME} \
                        ${NEXUS_HTTP_HOST}/repository/synergies/jarvix/${JOB_NAME}/${ARTIFACT_NAME}
                    set -x
                '''
            }
        }
    }

    post {
        success {
            sh 'sh ~/.scripts/ci/slack-success.sh'
        }
        failure {
            sh 'sh ~/.scripts/ci/slack-failure.sh'
            sh 'sh ~/.scripts/ci/slack-send-log.sh'
        }
    }
}
